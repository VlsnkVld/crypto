<template>
  <v-bottom-sheet v-model="sheet">
    <!-- Banner -->
    <template #activator="{ attrs }">
      <v-card
        class="mx-auto mt-10 mb-5"
        :class="{ 'referral-banner--colored': colored, 'bg--brand': !colored }"
        max-width="344"
        v-bind="attrs"
        @click="open"
      >
        <v-card-text>
          <v-row>
            <v-col>
              <h6 class="text-h6 text-left">Bets with friends!</h6>
              <p class="white--text mt-2">
                Start playing with your friends now ðŸ¤‘!
              </p>
              <div class="mt-2">
                <span
                  class="text-decoration-underline text-uppercase white--text"
                >
                  Invite friends
                </span>
                <v-icon small>$linkArrow</v-icon>
              </div>
            </v-col>
            <v-col cols="auto">
              <img
                height="110"
                width="75"
                src="~/static/images/robot-developer.svg"
                alt="Robot developer"
              />
            </v-col>
          </v-row>
        </v-card-text>
      </v-card>
    </template>

    <!-- Modal -->
    <v-list>
      <v-subheader>Invite friends</v-subheader>
      <!-- Copy link -->
      <v-list-item @click="copy">
        <v-list-item-avatar>
          <v-avatar size="40" class="white">
            <v-icon class="black--text">$clipboard</v-icon>
          </v-avatar>
        </v-list-item-avatar>
        <v-list-item-title>Copy link to clipboard</v-list-item-title>
      </v-list-item>
      <!-- Social -->
      <v-list-item
        v-for="(item, key) of links"
        :key="key"
        :href="item.link"
        target="_blank"
        rel="noopener noreferrer"
        @click="sheet = false"
      >
        <v-list-item-avatar>
          <i
            aria-hidden="true"
            class="v-icon notranslate material-icons theme--dark"
            style="font-size: 32px"
          >
            <svg viewBox="0 0 36 36" width="40" height="40" fill="currentColor">
              <path :d="item.icon" />
            </svg>
          </i>
        </v-list-item-avatar>
        <v-list-item-title>{{ item.title }}</v-list-item-title>
      </v-list-item>
    </v-list>
  </v-bottom-sheet>
</template>

<script>
import { REFERRAL_QUERY } from '~/plugins/auth'
export default {
  name: 'ReferralBanner',
  props: {
    colored: {
      type: Boolean,
      default: () => false,
    },
  },
  data() {
    return {
      sheet: false,
    }
  },
  computed: {
    link() {
      const port = location.port ? ':' + location.port : ''
      return `${location.protocol}//${location.hostname}${port}/?${REFERRAL_QUERY}=${this.$auth.user?.referral}`
    },
    links() {
      const link = encodeURIComponent(this.link)
      const title = encodeURIComponent('BitcyBets')
      const text = encodeURIComponent("\nLet's play together? ðŸ¤‘")

      return {
        facebook: {
          title: 'Facebook',
          link: `https://www.facebook.com/sharer.php?u=${link}`,
          icon:
            'M18 0C8.05884 0 0 8.05884 0 18C0 27.9412 8.05884 36 18 36C27.9412 36 36 27.9412 36 18C36 8.05884 27.9412 0 18 0ZM24.8671 9.16665L22.3775 9.16775C20.4252 9.16775 20.0477 10.0955 20.0477 11.4567V14.4582H24.7032L24.701 19.1594H20.048V31.2237H15.1922V19.1594H11.1329V14.4582H15.1922V10.9911C15.1922 6.96761 17.6505 4.77631 21.2394 4.77631L24.8674 4.78183V9.16665H24.8671Z',
        },
        twitter: {
          title: 'Twitter',
          link: `https://twitter.com/intent/tweet?url=${link}&text=${title}${text}`,
          icon:
            'M18 0C8.05884 0 0 8.05884 0 18C0 27.9412 8.05884 36 18 36C27.9412 36 36 27.9412 36 18C36 8.05884 27.9412 0 18 0ZM28.8847 13.1998C28.8932 13.4123 28.8976 13.6251 28.8976 13.8391C28.8976 21.5282 23.0466 29.4813 13.2554 29.4813C10.2623 29.4813 7.34805 28.6273 4.82787 27.0109C4.7752 26.9774 4.75347 26.9122 4.77447 26.8536C4.79546 26.7954 4.85475 26.7593 4.91552 26.7663C5.33831 26.8168 5.77068 26.8418 6.19973 26.8418C8.52841 26.8418 10.733 26.1218 12.5976 24.7558C10.3625 24.5673 8.44149 23.0547 7.75059 20.8969C7.73622 20.852 7.74654 20.803 7.77747 20.7677C7.80878 20.7323 7.85665 20.7168 7.90232 20.7253C8.52178 20.8428 9.15155 20.8505 9.75849 20.7518C7.45338 20.0355 5.83329 17.8763 5.83329 15.4179L5.83403 15.3465C5.83513 15.2997 5.86054 15.257 5.90105 15.2338C5.9412 15.2102 5.99128 15.2099 6.0318 15.2327C6.63284 15.5664 7.29796 15.7807 7.9804 15.8628C6.65567 14.807 5.87785 13.2064 5.87785 11.4942C5.87785 10.5065 6.13933 9.53567 6.63431 8.68677C6.65641 8.64884 6.69545 8.62453 6.73891 8.62122C6.78273 8.6168 6.82508 8.63595 6.85271 8.66983C9.56403 11.9955 13.5522 14.0431 17.817 14.3065C17.7459 13.9485 17.7098 13.5795 17.7098 13.2071C17.7098 10.1279 20.2149 7.62316 23.2937 7.62316C24.8074 7.62316 26.2702 8.2452 27.3188 9.33238C28.5006 9.09152 29.6264 8.65694 30.6665 8.04043C30.714 8.01207 30.7736 8.01649 30.8175 8.05074C30.8602 8.08536 30.8779 8.14281 30.8609 8.19585C30.5085 9.29813 29.8213 10.2597 28.898 10.9539C29.7675 10.8026 30.6112 10.547 31.4137 10.1909C31.4675 10.1662 31.5312 10.1816 31.5699 10.2269C31.6082 10.2726 31.6115 10.3378 31.5784 10.3872C30.8473 11.4813 29.9413 12.4275 28.8847 13.1998Z',
        },
        telegram: {
          title: 'Telegram',
          link: `https://t.me/share/url?url=${link}&text=${title}${text}`,
          icon:
            'M18 36C27.9435 36 36 27.9435 36 18C36 8.0565 27.9435 0 18 0C8.0565 0 0 8.0565 0 18C0 27.9435 8.0565 36 18 36ZM8.2365 17.61L25.5915 10.9185C26.397 10.6275 27.1005 11.115 26.8395 12.333L26.841 12.3315L23.886 26.253C23.667 27.24 23.0805 27.48 22.26 27.015L17.76 23.6985L15.5895 25.7895C15.3495 26.0295 15.147 26.232 14.682 26.232L15.0015 21.6525L23.3415 14.118C23.7045 13.7985 23.2605 13.6185 22.782 13.9365L12.4755 20.4255L8.0325 19.0395C7.068 18.7335 7.047 18.075 8.2365 17.61Z',
        },
        vk: {
          title: 'VK',
          link: `http://vk.com/share.php?url=${link}&title=${title}&comment=${text}`,
          icon:
            'M18 0C8.05921 0 0 8.05884 0 18C0 27.9412 8.05921 36 18 36C27.9408 36 36 27.9412 36 18C36 8.05884 27.9408 0 18 0ZM27.1306 19.9468C27.9695 20.7662 28.8571 21.5374 29.6102 22.4415C29.9439 22.8415 30.2584 23.2551 30.4978 23.7202C30.8396 24.3835 30.5309 25.1109 29.9373 25.1503L26.2496 25.1495C25.2972 25.2284 24.5393 24.8442 23.9003 24.1931C23.3902 23.6742 22.917 23.1199 22.4257 22.5833C22.225 22.3631 22.0136 22.1557 21.7617 21.9926C21.259 21.6656 20.8222 21.7657 20.5342 22.2909C20.2407 22.8253 20.1736 23.4175 20.1456 24.0123C20.1055 24.8818 19.8433 25.109 18.9708 25.1499C17.1065 25.2372 15.3377 24.9544 13.6936 24.0145C12.2433 23.1855 11.1208 22.0154 10.1426 20.6907C8.23783 18.1083 6.77905 15.2739 5.46832 12.3582C5.17332 11.7016 5.38914 11.3502 6.11355 11.3366C7.31711 11.3134 8.52067 11.3163 9.72423 11.3355C10.2141 11.3432 10.5381 11.6235 10.7263 12.0857C11.3767 13.6859 12.1741 15.2084 13.1732 16.6204C13.4395 16.9964 13.7113 17.3713 14.0984 17.6369C14.5256 17.93 14.8512 17.8332 15.0526 17.3562C15.1815 17.0531 15.2371 16.729 15.2651 16.4042C15.3609 15.2916 15.3723 14.1794 15.2065 13.0712C15.1034 12.3777 14.7134 11.9299 14.0221 11.7988C13.6701 11.7321 13.7216 11.6018 13.8929 11.4007C14.1901 11.053 14.4685 10.8379 15.025 10.8379L19.1914 10.8372C19.8481 10.9661 19.9954 11.2607 20.0845 11.9222L20.0882 16.5523C20.0804 16.8082 20.2167 17.5669 20.6763 17.7345C21.0446 17.856 21.2877 17.5606 21.5079 17.3275C22.5071 16.2672 23.219 15.0158 23.8565 13.7205C24.1379 13.1493 24.3806 12.5582 24.6163 11.966C24.7916 11.5281 25.0641 11.3127 25.5583 11.32L29.5705 11.3248C29.6887 11.3248 29.8087 11.3259 29.9259 11.3462C30.602 11.4618 30.7873 11.7528 30.5781 12.4124C30.2488 13.4487 29.6091 14.312 28.9838 15.1775C28.3135 16.1041 27.5986 16.9983 26.935 17.9289C26.3251 18.7797 26.3734 19.208 27.1306 19.9468Z',
        },
        ok: {
          title: 'Odnoklassniki',
          link: `https://connect.ok.ru/dk?st.cmd=WidgetSharePreview&st.shareUrl=${link}`,
          icon:
            'M18 0C8.05884 0 0 8.05921 0 18C0 27.9408 8.05884 36 18 36C27.9412 36 36 27.9408 36 18C36 8.05921 27.9412 0 18 0ZM18.0258 5.47384C21.5319 5.48342 24.3459 8.35126 24.3279 11.896C24.3102 15.359 21.4501 18.1657 17.9499 18.1539C14.4854 18.1422 11.6441 15.2699 11.6647 11.7999C11.6843 8.29197 14.5271 5.46427 18.0258 5.47384ZM25.1271 20.645C24.3518 21.4409 23.4186 22.0169 22.3822 22.4187C21.4026 22.7984 20.329 22.9895 19.2662 23.117C19.4271 23.2915 19.5026 23.3773 19.6028 23.4775C21.045 24.9275 22.4942 26.37 23.9316 27.824C24.4214 28.3198 24.5235 28.9341 24.2539 29.5097C23.9596 30.1395 23.2993 30.5534 22.6515 30.5088C22.2412 30.4805 21.9211 30.2768 21.6372 29.9907C20.5485 28.8954 19.4393 27.8196 18.3734 26.7037C18.0622 26.3789 17.9135 26.4408 17.6391 26.7229C16.5442 27.8506 15.4312 28.9602 14.312 30.064C13.8093 30.5597 13.2112 30.6495 12.6278 30.366C12.008 30.0662 11.6139 29.4331 11.6441 28.7963C11.6655 28.3669 11.8769 28.0376 12.1722 27.7438C13.6001 26.3189 15.0235 24.8895 16.4473 23.4613C16.542 23.3667 16.6296 23.2661 16.767 23.1188C14.825 22.9159 13.0738 22.4379 11.5745 21.2656C11.3882 21.1198 11.1963 20.9791 11.0269 20.8155C10.3702 20.1854 10.3043 19.4632 10.8232 18.72C11.2677 18.0836 12.0131 17.9135 12.7884 18.2792C12.9386 18.3495 13.0815 18.4386 13.2185 18.5329C16.0124 20.4528 19.8506 20.5055 22.6555 18.6187C22.9332 18.4066 23.2304 18.232 23.5748 18.144C24.2436 17.9716 24.8682 18.218 25.2269 18.8036C25.6375 19.4728 25.6327 20.1254 25.1271 20.645Z',
        },
      }
    },
  },
  methods: {
    copy() {
      try {
        navigator.clipboard.writeText(
          `Let's play together? ðŸ¤‘ BitcyBets â€”  ${this.link}`
        )
      } catch {}

      this.sheet = false
    },
    open() {
      try {
        navigator.share({
          title: 'BitcyBets',
          text: "Let's play together? ðŸ¤‘",
          url: this.link,
        })
      } catch {
        this.sheet = true
      }
    },
  },
}
</script>

<style lang="scss">
.referral-banner {
  &--colored {
    background: linear-gradient(98.37deg, #f0c -47.89%, #339 107.13%);
  }
}
</style>
